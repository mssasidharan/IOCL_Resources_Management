<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project Management</title>

  <!-- Tailwind CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel for JSX in-browser (prototype) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { background: #f8fafc; }
    /* small helper */
    .card { background: white; border-radius: 12px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
    .tiny { font-size: 12px; color: #6b7280; }
    .pill { background: #eef2ff; color: #1e40af; padding: 6px 8px; border-radius: 8px; font-weight: 600; }
    .table-scroll { max-height: 52vh; overflow:auto; }
    .input { padding:8px; border:1px solid #e6edf3; border-radius:6px; width:100%; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    /**************************************************************************
     * Utilities
     **************************************************************************/
    function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }
    function downloadFile(content, filename, mime='text/csv'){
      const blob = new Blob([content], {type: mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }
    function toCSV(rows, columns){
      const header = columns.join(',');
      const lines = rows.map(r => columns.map(c => {
        const v = r[c] == null ? '' : String(r[c]);
        return `"${v.replace(/"/g,'""')}"`;
      }).join(','));
      return [header, ...lines].join('\\n');
    }
    function parseDate(s){ if(!s) return null; const d = new Date(s); return isNaN(d) ? null : d; }
    function dateToStr(d){ if(!d) return ''; return new Date(d).toISOString().slice(0,10); }
    function daysBetween(a,b){ const A = new Date(a); const B = new Date(b); return Math.max(0, Math.round((B - A)/(1000*60*60*24))+1); }

    /**************************************************************************
     * Default demo data
     **************************************************************************/
    const DEFAULT_TASKS = [
      { id: 'T1', typeOfProgram:'Type-2', lob:'LPG', stateOffice:'Tamil Nadu State Office', locationName:'LPG BP - ERODE', startDate:'2025-10-27', endDate:'2025-11-01', actualStart:'', deferredStart:'', primaryFac:'R1', secondaryFac:'R2' },
      { id: 'T2', typeOfProgram:'Type-3', lob:'LPG', stateOffice:'Karnataka State Office', locationName:'LPG BP - MYSURU', startDate:'2025-11-05', endDate:'2025-11-06', actualStart:'', deferredStart:'', primaryFac:'', secondaryFac:'' }
    ];
    const DEFAULT_RESOURCES = [
      { id:'R1', name:'Rahul Kumar', baseLocation:'Chennai', stateOffice:'Tamil Nadu', designation:'Trainer', capacityDaysPerWeek:6 },
      { id:'R2', name:'Arun B', baseLocation:'Coimbatore', stateOffice:'Tamil Nadu', designation:'Trainer', capacityDaysPerWeek:6 },
      { id:'R3', name:'Nisha P', baseLocation:'Bengaluru', stateOffice:'Karnataka', designation:'Field', capacityDaysPerWeek:6 }
    ];

    /**************************************************************************
     * Local storage helpers
     **************************************************************************/
    function saveToLocal(key, value){ try { localStorage.setItem(key, JSON.stringify(value)); } catch(e){} }
    function loadFromLocal(key, fallback){ try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : fallback; } catch(e) { return fallback; } }

    /**************************************************************************
     * App
     **************************************************************************/
    function App(){
      // pages: landing, tasks, allocation
      const [page, setPage] = useState('landing');

      // Load persistent data or defaults
      const [tasks, setTasks] = useState(() => loadFromLocal('pm_tasks', DEFAULT_TASKS));
      const [resources, setResources] = useState(() => loadFromLocal('pm_resources', DEFAULT_RESOURCES));

      // selection / UI
      useEffect(()=> saveToLocal('pm_tasks', tasks), [tasks]);
      useEffect(()=> saveToLocal('pm_resources', resources), [resources]);

      return (
        <div className="p-6 min-h-screen">
          <Header onNav={setPage} />
          <main className="mt-6">
            {page === 'landing' && <Landing onOpen={(p)=> setPage(p)} />}
            {page === 'tasks' && <TasksPage tasks={tasks} setTasks={setTasks} onBack={()=> setPage('landing')} />}
            {page === 'allocation' && <AllocationPage tasks={tasks} setTasks={setTasks} resources={resources} setResources={setResources} onBack={()=> setPage('landing')} />}
          </main>
          <footer className="mt-8 text-xs text-gray-500">Prototype — data stored locally in browser. Export CSV to back up.</footer>
        </div>
      );
    }

    /**************************************************************************
     * Header
     **************************************************************************/
    function Header({ onNav }){
      return (
        <div className="flex items-center justify-between">
          <div>
            <div className="text-2xl font-bold">Project Management</div>
            <div className="text-sm text-gray-500">Manage tasks, allocate resources, and monitor utilization</div>
          </div>
          <div className="flex gap-2 items-center">
            <button className="px-3 py-2 rounded bg-white border" onClick={()=>onNav('landing')}>Home</button>
            <button className="px-3 py-2 rounded bg-blue-600 text-white" onClick={()=>onNav('tasks')}>Tasks</button>
            <button className="px-3 py-2 rounded bg-indigo-600 text-white" onClick={()=>onNav('allocation')}>Resource Allocation</button>
          </div>
        </div>
      );
    }

    /**************************************************************************
     * Landing with tiles
     **************************************************************************/
    function Landing({ onOpen }){
      const tiles = [
        { key:'tasks', title:'Task Creation', desc:'Add and manage tasks (locations, dates, facilitators)' },
        { key:'allocation', title:'Resource Allocation', desc:'Allocate resources and manage resource details' },
        { key:'dash', title:'Dashboards', desc:'Utilization & monthly views (inside Resource Management)' },
        { key:'scheduling', title:'Project Scheduling', desc:'Gantt & timelines (future)' },
      ];
      return (
        <div>
          <div className="grid grid-cols-3 gap-6">
            {tiles.map(t => (
              <div key={t.key} className="card p-6">
                <div className="flex items-start justify-between">
                  <div>
                    <div className="text-lg font-semibold">{t.title}</div>
                    <div className="tiny mt-1">{t.desc}</div>
                  </div>
                  <div>
                    <button className="px-3 py-2 bg-blue-600 text-white rounded" onClick={()=> onOpen(t.key)}>Open</button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="mt-6 tiny text-gray-600">Tip: Start by adding tasks in Task Creation, then define your resources and allocate.</div>
        </div>
      );
    }

    /**************************************************************************
     * Tasks Page - full featured task creation and editing
     **************************************************************************/
    function TasksPage({ tasks, setTasks, onBack }){
      // columns based on screenshot + added actualStart/deferredStart
      const columns = [
        { key:'typeOfProgram', label:'Type of Program' },
        { key:'lob', label:'LOB' },
        { key:'stateOffice', label:'State Office' },
        { key:'locationName', label:'Location Name' },
        { key:'startDate', label:'Start Date' },
        { key:'endDate', label:'End Date' },
        { key:'actualStart', label:'Actual Start' },
        { key:'deferredStart', label:'Deferred Start' },
        { key:'primaryFac', label:'Primary Facilitator' },
        { key:'secondaryFac', label:'Secondary Facilitator' }
      ];

      // helpers
      function addRow(){
        const id = uid('T');
        const r = { id, typeOfProgram:'Type-2', lob:'LPG', stateOffice:'', locationName:'', startDate:'', endDate:'', actualStart:'', deferredStart:'', primaryFac:'', secondaryFac:'' };
        setTasks(prev => [r, ...prev]);
      }
      function updateRow(id, updates){
        setTasks(prev => prev.map(t => t.id === id ? {...t, ...updates} : t));
      }
      function deleteRow(id){
        if(!confirm('Delete task ' + id + '?')) return;
        setTasks(prev => prev.filter(t => t.id !== id));
      }
      function importCSV(evt){
        const f = evt.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = e => {
          const text = e.target.result;
          const lines = text.trim().split(/\\r?\\n/);
          const headers = lines[0].split(',');
          const rows = lines.slice(1).map(line => {
            const arr = line.split(',');
            const obj = {};
            headers.forEach((h, idx) => obj[h.trim()] = (arr[idx]||'').replace(/^"|"$/g,''));
            return {
              id: uid('T'),
              typeOfProgram: obj['Type of Program']||obj['typeOfProgram']||'Type-2',
              lob: obj['LOB']||obj['lob']||'',
              stateOffice: obj['State Office']||obj['stateOffice']||'',
              locationName: obj['Location Name']||obj['locationName']||'',
              startDate: obj['Start Date']||obj['startDate']||'',
              endDate: obj['End Date']||obj['endDate']||'',
              actualStart: obj['Actual Start']||'',
              deferredStart: obj['Deferred Start']||'',
              primaryFac: obj['Primary Facilitator']||'',
              secondaryFac: obj['Secondary Facilitator']||''
            };
          });
          setTasks(prev => [...rows, ...prev]);
        };
        reader.readAsText(f);
      }
      function exportCSV(){
        const columnsOut = columns.map(c=>c.label);
        const rows = tasks.map(t => columns.map(c => t[c.key] || ''));
        const header = columnsOut.join(',');
        const lines = rows.map(r => r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','));
        downloadFile([header, ...lines].join('\\n'), 'tasks_export.csv');
      }

      return (
        <div>
          <div className="flex items-center justify-between mb-4">
            <div>
              <button className="px-2 py-1 bg-gray-100 rounded mr-2" onClick={onBack}>← Back</button>
              <span className="text-xl font-semibold">Task Creation</span>
            </div>
            <div className="flex gap-2">
              <label className="px-3 py-2 bg-white border rounded cursor-pointer">
                Import CSV <input type="file" accept=".csv" onChange={importCSV} className="hidden" />
              </label>
              <button className="px-3 py-2 bg-blue-600 text-white rounded" onClick={addRow}>Add Row</button>
              <button className="px-3 py-2 bg-green-600 text-white rounded" onClick={exportCSV}>Export CSV</button>
            </div>
          </div>

          <div className="card p-4">
            <div className="table-scroll">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-xs text-gray-500">
                    <th className="p-2">ID</th>
                    {columns.map(c => <th key={c.key} className="p-2">{c.label}</th>)}
                    <th className="p-2">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {tasks.map(t => (
                    <tr key={t.id} className="border-t">
                      <td className="p-2">{t.id}</td>

                      <td className="p-2">
                        <input className="input" value={t.typeOfProgram||''} onChange={e=>updateRow(t.id, {typeOfProgram: e.target.value})} />
                      </td>

                      <td className="p-2"><input className="input" value={t.lob||''} onChange={e=>updateRow(t.id, {lob: e.target.value})} /></td>

                      <td className="p-2"><input className="input" value={t.stateOffice||''} onChange={e=>updateRow(t.id, {stateOffice: e.target.value})} /></td>

                      <td className="p-2"><input className="input" value={t.locationName||''} onChange={e=>updateRow(t.id, {locationName: e.target.value})} /></td>

                      <td className="p-2"><input type="date" className="input" value={t.startDate||''} onChange={e=>updateRow(t.id, {startDate: e.target.value})} /></td>

                      <td className="p-2"><input type="date" className="input" value={t.endDate||''} onChange={e=>updateRow(t.id, {endDate: e.target.value})} /></td>

                      <td className="p-2"><input type="date" className="input" value={t.actualStart||''} onChange={e=>updateRow(t.id, {actualStart: e.target.value})} /></td>

                      <td className="p-2"><input type="date" className="input" value={t.deferredStart||''} onChange={e=>updateRow(t.id, {deferredStart: e.target.value})} /></td>

                      <td className="p-2"><input className="input" value={t.primaryFac||''} onChange={e=>updateRow(t.id, {primaryFac: e.target.value})} /></td>

                      <td className="p-2"><input className="input" value={t.secondaryFac||''} onChange={e=>updateRow(t.id, {secondaryFac: e.target.value})} /></td>

                      <td className="p-2">
                        <button className="px-2 py-1 bg-rose-500 text-white rounded" onClick={()=>deleteRow(t.id)}>Delete</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="mt-3 tiny text-gray-500">Tip: fill Actual Start when the program begins; use Deferred Start to record postponements.</div>
          </div>
        </div>
      );
    }

    /**************************************************************************
     * Allocation Page - contains two sub-tabs: Allocation & Resource Management
     **************************************************************************/
    function AllocationPage({ tasks, setTasks, resources, setResources, onBack }){
      const [subTab, setSubTab] = useState('allocation'); // allocation | resources
      // copy of tasks for editing allocations (mutate via setTasks)
      function assignResource(taskId, resourceId){
        setTasks(prev => prev.map(t => t.id === taskId ? {...t, assignedResource: resourceId} : t));
      }
      function autoAllocate(){
        if(resources.length === 0){ alert('No resources defined. Add resources first.'); return; }
        // greedy by earliest nextFree (naive)
        const resState = resources.map(r => ({ ...r, nextFree: 0 }));
        // sort tasks: those with startDate first or trainingType preference
        const indices = tasks.map((t,i)=>i).sort((a,b) => {
          const A = tasks[a].startDate ? new Date(tasks[a].startDate).getTime() : 0;
          const B = tasks[b].startDate ? new Date(tasks[b].startDate).getTime() : 0;
          return A - B;
        });
        const newTasks = tasks.slice();
        for(const idx of indices){
          // find resource with min nextFree
          resState.sort((x,y) => x.nextFree - y.nextFree);
          const best = resState[0];
          newTasks[idx] = {...newTasks[idx], assignedResource: best.id || ''};
          // estimate duration in days
          const dur = tasks[idx].startDate && tasks[idx].endDate ? daysBetween(tasks[idx].startDate, tasks[idx].endDate) : 1;
          best.nextFree += dur;
        }
        setTasks(newTasks);
        alert('Auto allocation (naive) completed.');
      }

      // Remove resource references on deletion
      function removeResource(id){
        if(!confirm('Delete resource '+id+'?')) return;
        setResources(prev => prev.filter(r => r.id !== id));
        // clear assignments pointing to removed resource
        setTasks(prev => prev.map(t => t.assignedResource === id ? {...t, assignedResource: ''} : t));
      }

      return (
        <div>
          <div className="flex items-center justify-between mb-4">
            <div>
              <button className="px-2 py-1 bg-gray-100 rounded mr-2" onClick={onBack}>← Back</button>
              <span className="text-xl font-semibold">Resource Allocation</span>
            </div>
            <div className="flex gap-2">
              <button onClick={()=> setSubTab('allocation')} className={'px-3 py-2 rounded ' + (subTab==='allocation' ? 'bg-indigo-600 text-white' : 'bg-white border')}>Allocation</button>
              <button onClick={()=> setSubTab('resources')} className={'px-3 py-2 rounded ' + (subTab==='resources' ? 'bg-indigo-600 text-white' : 'bg-white border')}>Resource Management</button>
            </div>
          </div>

          {subTab === 'allocation' && (
            <div className="grid grid-cols-12 gap-6">
              <section className="col-span-8 card p-4">
                <div className="flex items-center justify-between mb-3">
                  <div className="font-semibold">Assign resources to tasks</div>
                  <div className="flex gap-2">
                    <button className="px-3 py-2 bg-gray-100 rounded" onClick={autoAllocate}>Auto Allocate</button>
                    <button className="px-3 py-2 bg-green-600 text-white rounded" onClick={()=>{
                      // export allocations
                      const rows = tasks.map(t => ({ id: t.id, locationName: t.locationName, assignedResource: t.assignedResource || '' }));
                      const csv = toCSV(rows, ['id','locationName','assignedResource']);
                      downloadFile(csv, 'allocations.csv');
                    }}>Export Allocations</button>
                  </div>
                </div>

                <div className="table-scroll">
                  <table className="min-w-full text-sm">
                    <thead className="text-xs text-gray-500">
                      <tr className="text-left">
                        <th className="p-2">ID</th>
                        <th className="p-2">Location</th>
                        <th className="p-2">State Office</th>
                        <th className="p-2">Start</th>
                        <th className="p-2">End</th>
                        <th className="p-2">Assigned</th>
                        <th className="p-2">Days</th>
                      </tr>
                    </thead>
                    <tbody>
                      {tasks.map(t => {
                        const days = t.startDate && t.endDate ? daysBetween(t.startDate, t.endDate) : (t.actualStart && t.endDate ? daysBetween(t.actualStart, t.endDate) : 1);
                        return (
                          <tr key={t.id} className="border-t">
                            <td className="p-2">{t.id}</td>
                            <td className="p-2">{t.locationName}</td>
                            <td className="p-2">{t.stateOffice}</td>
                            <td className="p-2">{t.startDate}</td>
                            <td className="p-2">{t.endDate}</td>
                            <td className="p-2">
                              <select value={t.assignedResource || ''} onChange={(e)=> assignResource(t.id, e.target.value)} className="p-1 border rounded">
                                <option value=''>-- none --</option>
                                {resources.map(r => <option key={r.id} value={r.id}>{r.id} — {r.name}</option>)}
                              </select>
                            </td>
                            <td className="p-2">{days}</td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </section>

              <aside className="col-span-4 card p-4">
                <div className="flex items-center justify-between">
                  <div className="font-semibold">Quick Summary</div>
                  <div className="tiny text-gray-500">{tasks.filter(t=>t.assignedResource).length}/{tasks.length} assigned</div>
                </div>
                <div className="mt-4">
                  <h4 className="tiny font-semibold">Resource snapshot</h4>
                  <div className="mt-2 space-y-2">
                    {resources.map(r => {
                      const assignedDays = tasks.reduce((s,t)=> s + ((t.assignedResource===r.id) ? (t.startDate && t.endDate ? daysBetween(t.startDate,t.endDate) : 1) : 0), 0);
                      return (
                        <div key={r.id} className="flex items-center justify-between">
                          <div>
                            <div className="font-medium">{r.id} — {r.name}</div>
                            <div className="tiny text-gray-500">{r.designation || ''} • {r.stateOffice || r.baseLocation || ''}</div>
                          </div>
                          <div className="text-right">
                            <div className="font-semibold">{assignedDays}d</div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </aside>
            </div>
          )}

          {subTab === 'resources' && (
            <ResourceManagement
              resources={resources} setResources={setResources}
              tasks={tasks} setTasks={setTasks} removeResource={removeResource}
            />
          )}
        </div>
      );
    }

    /**************************************************************************
     * Resource Management component: edit resources, show calendar & utilization
     **************************************************************************/
    function ResourceManagement({ resources, setResources, tasks, setTasks, removeResource }){
      const [selected, setSelected] = useState(resources[0] ? resources[0].id : null);
      const [monthOffset, setMonthOffset] = useState(0); // 0 = current month
      useEffect(()=> { if(!selected && resources[0]) setSelected(resources[0].id); }, [resources]);

      function addResource(){
        const id = uid('R');
        const r = { id, name: 'New Resource', baseLocation:'', stateOffice:'', designation:'Field', capacityDaysPerWeek:6 };
        setResources(prev => [r, ...prev]);
        setSelected(id);
      }
      function updateResource(id, updates){
        setResources(prev => prev.map(r => r.id === id ? {...r, ...updates} : r));
      }

      // compute utilization by month for selected resource
      const utilizationByMonth = useMemo(()=> {
        if(!selected) return [];
        // build 12 months starting from current month + monthOffset
        const now = new Date();
        const start = new Date(now.getFullYear(), now.getMonth() + monthOffset, 1);
        const months = [];
        for(let m=0;m<6;m++){
          const d = new Date(start.getFullYear(), start.getMonth()+m, 1);
          months.push(d);
        }
        const res = resources.find(r=>r.id===selected);
        const assignedTasks = tasks.filter(t => t.assignedResource === selected);
        return months.map(mStart => {
          const mEnd = new Date(mStart.getFullYear(), mStart.getMonth()+1, 0);
          let days = 0;
          for(const t of assignedTasks){
            const s = parseDate(t.startDate) || parseDate(t.actualStart) || null;
            const e = parseDate(t.endDate) || null;
            if(!s || !e) continue;
            const overlapStart = s > mStart ? s : mStart;
            const overlapEnd = e < mEnd ? e : mEnd;
            if(overlapStart <= overlapEnd){
              days += daysBetween(overlapStart, overlapEnd);
            }
          }
          return { month: mStart, days, capacity: (res?.capacityDaysPerWeek||6) * 4 }; // 4-week baseline
        });
      }, [selected, resources, tasks, monthOffset]);

      // simple chart using Chart.js
      const chartRef = useRef(null);
      useEffect(()=> {
        const ctx = chartRef.current && chartRef.current.getContext('2d');
        if(!ctx || !selected) return;
        // cleanup existing
        if(window._resChart) window._resChart.destroy();
        const labels = utilizationByMonth.map(u => u.month.toLocaleString('default',{month:'short', year:'numeric'}));
        const data = utilizationByMonth.map(u => u.days);
        window._resChart = new Chart(ctx, {
          type:'bar',
          data:{ labels, datasets: [{ label: 'Assigned days', data }] },
          options:{ responsive:true, maintainAspectRatio:false }
        });
      }, [utilizationByMonth, selected]);

      return (
        <div className="grid grid-cols-12 gap-6">
          <aside className="col-span-4 card p-4">
            <div className="flex items-center justify-between">
              <div className="font-semibold">Resources</div>
              <button className="px-2 py-1 bg-blue-600 text-white rounded" onClick={addResource}>Add</button>
            </div>

            <div className="mt-3 space-y-2">
              {resources.map(r => (
                <div key={r.id} className={'p-2 rounded border ' + (selected===r.id ? 'border-indigo-600 bg-indigo-50' : '')} onClick={()=>setSelected(r.id)} style={{cursor:'pointer'}}>
                  <div className="font-semibold">{r.id} — {r.name}</div>
                  <div className="tiny text-gray-500">{r.designation} • {r.stateOffice || r.baseLocation}</div>
                </div>
              ))}
            </div>

            <div className="mt-4">
              <h4 className="font-medium tiny">Edit selected</h4>
              {selected ? (
                <ResourceEditor resource={resources.find(r=>r.id===selected)} onUpdate={u=>updateResource(selected,u)} onDelete={()=> removeResource(selected)} />
              ) : <div className="tiny text-gray-500 mt-2">Select a resource to edit</div>}
            </div>
          </aside>

          <section className="col-span-8 card p-4">
            <div className="flex items-center justify-between">
              <div className="font-semibold">Resource utilization</div>
              <div className="tiny text-gray-500">Month window: 6 months</div>
            </div>

            <div className="mt-4 grid grid-cols-2 gap-4 items-start">
              <div style={{height: 220}}>
                <canvas ref={chartRef} />
              </div>

              <div>
                <div className="flex items-center gap-2">
                  <button className="px-2 py-1 bg-gray-100 rounded" onClick={()=> setMonthOffset(m => m-1)}>◀</button>
                  <div className="font-medium">
                    {utilizationByMonth[0] ? utilizationByMonth[0].month.toLocaleString('default',{month:'short', year:'numeric'}) : ''} 
                    {' '}—{' '}
                    {utilizationByMonth[utilizationByMonth.length-1] ? utilizationByMonth[utilizationByMonth.length-1].month.toLocaleString('default',{month:'short', year:'numeric'}) : ''}
                  </div>
                  <button className="px-2 py-1 bg-gray-100 rounded" onClick={()=> setMonthOffset(m => m+1)}>▶</button>
                </div>

                <div className="mt-3 space-y-2">
                  {utilizationByMonth.map(u => (
                    <div key={u.month} className="flex items-center justify-between">
                      <div className="tiny">{u.month.toLocaleString('default',{month:'short', year:'numeric'})}</div>
                      <div className="font-semibold">{u.days}d / {u.capacity}d</div>
                    </div>
                  ))}
                </div>

                <div className="mt-4 tiny text-gray-500">Assigned tasks for selected resource:</div>
                <div className="mt-2 max-h-48 overflow-auto">
                  <table className="min-w-full text-sm">
                    <thead><tr className="text-xs text-gray-500"><th className="p-1">Task</th><th className="p-1">Start</th><th className="p-1">End</th></tr></thead>
                    <tbody>
                      {tasks.filter(t => t.assignedResource === selected).map(t => (
                        <tr key={t.id} className="border-t">
                          <td className="p-1">{t.id} — {t.locationName}</td>
                          <td className="p-1">{t.startDate}</td>
                          <td className="p-1">{t.endDate}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </div>
      );
    }

    function ResourceEditor({ resource, onUpdate, onDelete }){
      if(!resource) return null;
      return (
        <div className="mt-2 space-y-2">
          <div>
            <label className="tiny">Name</label>
            <input className="input w-full" value={resource.name || ''} onChange={e=> onUpdate({ name: e.target.value })} />
          </div>
          <div>
            <label className="tiny">Base location</label>
            <input className="input w-full" value={resource.baseLocation || ''} onChange={e=> onUpdate({ baseLocation: e.target.value })} />
          </div>
          <div>
            <label className="tiny">State office</label>
            <input className="input w-full" value={resource.stateOffice || ''} onChange={e=> onUpdate({ stateOffice: e.target.value })} />
          </div>
          <div>
            <label className="tiny">Designation</label>
            <input className="input w-full" value={resource.designation || ''} onChange={e=> onUpdate({ designation: e.target.value })} />
          </div>
          <div>
            <label className="tiny">Capacity days / week</label>
            <input type="number" className="input w-36" value={resource.capacityDaysPerWeek || 6} onChange={e=> onUpdate({ capacityDaysPerWeek: Number(e.target.value) })} />
          </div>
          <div className="flex gap-2">
            <button className="px-3 py-2 bg-yellow-500 text-white rounded" onClick={()=> onUpdate({ name: resource.name })}>Save</button>
            <button className="px-3 py-2 bg-rose-600 text-white rounded" onClick={()=> { if(confirm('Delete resource?')) onDelete(); } }>Delete</button>
          </div>
        </div>
      );
    }

    /**************************************************************************
     * Render
     **************************************************************************/
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
